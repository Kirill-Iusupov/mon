var app;(()=>{var e={3553:(e,t,r)=>{const n=r(5096),o=r(3611),s=r(5681),a=r(7544),i=r(1269),c=r(1976),l=r(2919),u=r(7177),d=r(2830),g=a.DOC_PATH;e.exports=new class{async doc(e,t){const r=e.i18n.resolvedLanguage,o=await l.getLangId(r),s=e.cookies[a.COOKIE_NAME],{id:i}=await u.getUser(s),d=await c.doc(o,i);return d?n(t,d,e.t("success"),!1,200):n(t,!1,e.t("error"),!0,400)}async docSave(e,t){if(!o(e.body,i.docSaveSchema))return n(t,{status:"error",message:e.t("inValidFormat")},e.t("inValidFormat"),!0,400);if(!e.files||0===Object.keys(e.files).length)return n(t,{status:"error",message:e.t("inValidFormat")},e.t("inValidFormat"),!0,400);const{idDoc:r,docName:s}=e.body;let l=e.files.file;const g=Number(r),p=d.onlyLetterNumberDot(d.transliterate(String(s).slice(-20))),m=e.cookies[a.COOKIE_NAME],{id:y}=await u.getUser(m);if(await c.iudDocFile(g,y,1,p,l.data)){const r=`${g}_${y}_${p}`,o=await c.docSave(y,g,r);if(o)return n(t,o,e.t("success"),!1,200)}return n(t,!1,e.t("error"),!0,400)}async docShow(e,t){const{fileName:r}=e.params,n=d.onlyLetterNumberDotUnderscore(r),o=`${g}${n}`;return await s.exists(o)?t.download(o,String(n).split("_")[2]):t.redirect("/assets/logo.svg")}async docShowPdf(e,t){const{q:r,u:n}=e.query;if("frompdf"!==r)return t.redirect("/assets/logo.svg");if(!await c.exportPdfFileExpireValidate(String(n)))return t.redirect("/assets/logo.svg");const{fileName:o}=e.params,a=d.onlyLetterNumberDotUnderscore(o),i=`${g}${a}`;return await s.exists(i)?t.download(i,String(a).split("_")[2]):t.redirect("/assets/logo.svg")}}},3038:(e,t,r)=>{const n=r(6860).Router(),o=r(3553),s=r(6351);n.get("/:fileName",s.is_staff_or_challenger,o.docShow),n.get("/pdf/:fileName",o.docShowPdf),n.get("/",s.is_challenger,o.doc),n.put("/",s.is_challenger,o.docSave),e.exports=n},1269:e=>{e.exports={docSaveSchema:{type:"object",properties:{idDoc:{type:"string",required:!0},docName:{type:"string",required:!0}}}}},1976:(e,t,r)=>{const n=r(6427),o=r(5681),s=r(5325),a=r(7544).DOC_PATH;e.exports={doc:async function(e,t){try{const{rows:r}=await n.query("select * from public.fn_challenger_document($1, $2);",[e,t]);return r}catch(e){return console.log("error challenger doc",e.message),!1}},docSave:async function(e,t,r){try{return!(await n.query("call sp_challenger_document($1, $2, $3);",[e,t,r])).error}catch(e){return console.log("error challenger save",e.message),!1}},iudDocFile:async function(e,t,r,n,s){try{const i=`${a}${e}_${t}_${n}`;return 0===r&&await o.write(i,s),1===r&&await o.write(i,s),2===r&&await o.deleteFile(i),!0}catch(e){return console.log("error iudDocFile",e.message),!1}},exportPdfFileExpireValidate:async function(e){try{const t=s.decrypt(decodeURIComponent(e));return new Date(t)>new Date}catch(e){return console.log("exportPdfFileExpireValidate => ",e.message),!1}}}},6919:(e,t,r)=>{const n=r(3038);e.exports=n},1497:(e,t,r)=>{const n=r(5096),o=r(3611),s=r(7544),a=r(6878),i=r(3165),c=r(2919),l=r(7177);e.exports=new class{async info(e,t){const r=e.i18n.resolvedLanguage,o=await c.getLangId(r),a=e.cookies[s.COOKIE_NAME],{id:u}=await l.getUser(a),d=await i.info(o,u);return d?n(t,d,e.t("success"),!1,200):n(t,!1,e.t("error"),!0,400)}async infoSave(e,t){if(!o(e.body,a.infoSaveSchema))return n(t,{status:"error",message:e.t("inValidFormat")},e.t("inValidFormat"),!0,400);const{district:r,address:c,education:u,direction:d,kg:g,ru:p,en:m,other:y}=e.body,f=e.cookies[s.COOKIE_NAME],{id:h}=await l.getUser(f),w=await i.infoSave(h,r,c,u,d,g,p,m,y);return w?n(t,w,e.t("success"),!1,200):n(t,!1,e.t("error"),!0,400)}}},9366:(e,t,r)=>{const n=r(6860).Router(),o=r(1497),s=r(6351);n.get("/",s.is_challenger,o.info),n.post("/",s.is_challenger,o.infoSave),e.exports=n},6878:e=>{e.exports={infoSaveSchema:{type:"object",properties:{district:{type:"number",required:!0},address:{type:"string",required:!0},education:{type:"number",required:!0},direction:{type:"number",required:!0},kg:{type:"number",required:!0},ru:{type:"number",required:!0},en:{type:"number",required:!0},other:{type:"number",required:!0}}}}},3165:(e,t,r)=>{const n=r(6427);e.exports={info:async function(e,t){try{const{rowCount:r,rows:o}=await n.query("select * from public.fn_challenger_info($1, $2);",[e,t]);return!!r&&o[0]}catch(e){return console.log("error challenger info",e.message),!1}},infoSave:async function(e,t,r,o,s,a,i,c,l){try{return!(await n.query("call sp_challenger_info_insUpd($1, $2, $3,$4,$5,$6,$7,$8,$9);",[e,t,r,o,s,a,i,c,l])).error}catch(e){return console.log("error challenger infoSave",e.message),!1}}}},7444:(e,t,r)=>{const n=r(9366);e.exports=n},7424:(e,t,r)=>{const n=r(5096),o=r(3611),s=r(2830),a=r(1726),i=r(9840),c=r(5681),l=r(7544),u=r(3686),d=r(8166),g=r(2919),p=r(7177),m=l.AVATAR_PATH,y=l.APP_URL;e.exports=new class{async update(e,t){if(!o(e.body,u.updateSchema))return n(t,{status:"error",message:e.t("inValidFormat")},e.t("inValidFormat"),!0,400);const{idEmp:r,surname:s,names:a,patronymic:c,login:g,dateBirth:m,passport:y,passportDate:f,pin:h,idGender:w,idNation:E,idCitizen:S,idMartial:_,idEduc:x,telefon:b,address:O,email:I,isActive:C,idSpeciality:T,idStepen:v,surnameEn:$,namesEn:A,patronymicEn:D,role:R}=e.body;if(!R||0==JSON.parse(R)?.length)return n(t,{status:"error",message:e.t("inValidFormat")},e.t("inValidFormat"),!0,400);const L=e.cookies[l.COOKIE_NAME],{id:q}=await p.getUser(L),F=await d.update(r,s,a,c,g,m,y,f,h,w,E,S,_,x,b,O,I,q,C,T,v,$,A,D);if(F){const o=await d.roleList(1,r),s=new Set(o.filter((e=>!0===e.this_employee)).map((e=>e.id_role))),a=JSON.parse(R),c=new Set(a),l=i.difference(s,c),u=i.difference(c,s),g=Array.from(l).map((async e=>{const t=await d.roleDelete(r,e);return t&&t.length&&t[0]})),p=Array.from(u).map((async e=>{const t=await d.roleInsert(r,e);return t&&t.length&&t[0]}));return await Promise.all(g),await Promise.all(p),n(t,{...F[0]},e.t("success"),!1,200)}return n(t,!1,e.t("error"),!0,400)}async dataFill(e,t){const r=e.cookies[l.COOKIE_NAME],{id:o}=await p.getUser(r),s=await d.dataFill(o);return s?n(t,s,e.t("success"),!1,200):n(t,!1,e.t("error"),!0,400)}async detail(e,t){const r=e.i18n.resolvedLanguage,o=await g.getLangId(r),s=e.cookies[l.COOKIE_NAME],{id:a}=await p.getUser(s),i=await d.detail(o,a);return i?n(t,i,e.t("success"),!1,200):n(t,!1,e.t("error"),!0,400)}async detailSave(e,t){if(!o(e.body,u.detailSaveSchema))return n(t,{status:"error",message:e.t("inValidFormat")},e.t("inValidFormat"),!0,400);const{telephone:r,email:s}=e.body,a=e.cookies[l.COOKIE_NAME],{id:i}=await p.getUser(a),c=await d.detailSave(i,r,s);return c?n(t,c,e.t("success"),!1,200):n(t,!1,e.t("error"),!0,400)}async photo(e,t){try{if(!e.files||0===Object.keys(e.files).length)return n(t,{status:"error",message:e.t("inValidFormat")},e.t("inValidFormat"),!0,400);const r=e.cookies[l.COOKIE_NAME],{id:i}=await p.getUser(r);if(!o({id:i},u.photoSchema))return n(t,{status:"error",message:e.t("inValidFormat")},e.t("inValidFormat"),!0,400);const c=e.files.file;if(!c.mimetype.includes("image/"))return n(t,{status:"error",message:e.t("inValidFormat")},e.t("inValidFormat"),!0,400);const g="jpeg",y=s.md5(String(i)+Date.now()),f=`${m}lg-${y}.`,h=`${m}sm-${y}.`,w=`${y}.${g}`;a.normal(c.data,f,g),a.minimized(c.data,h,g);const E=await d.photo(i,w);return E?n(t,E,e.t("success"),!1,200):n(t,!1,e.t("error"),!0,400)}catch(r){return console.log("error Challenger photo"),console.log({error:r}),n(t,!1,e.t("error"),!0,400)}}async photoShow(e,t){const{fileName:r,size:n}=e.params,o=`${m}${"lg"===n?"lg":"sm"}-${r}`;return await c.exists(o)?t.sendFile(o):t.redirect(`/${y}/public/logo.svg`)}}},3459:(e,t,r)=>{const n=r(6860).Router(),o=r(7424),s=r(6351);n.post("/fill",s.is_challenger,o.dataFill),n.get("/detail",s.is_challenger,o.detail),n.post("/detail",s.is_challenger,o.detailSave),n.post("/photo",s.is_challenger,o.photo),n.get("/photo/:size/:fileName",o.photoShow),e.exports=n},3686:e=>{e.exports={docSaveSchema:{type:"object",properties:{kg:{type:"number",required:!0},ru:{type:"number",required:!0},en:{type:"number",required:!0},other:{type:"number",required:!0}}},detailSaveSchema:{type:"object",properties:{telephone:{type:"string"},email:{type:"string"}}},langSaveSchema:{type:"object",properties:{id:{type:"string",required:!0},value:{type:"string",required:!0}}},universitySaveSchema:{type:"object",properties:{telephone:{type:"string"},email:{type:"string"},district:{type:"number",required:!0},address:{type:"string"},education:{type:"number",required:!0},kyrgyz:{type:"number",required:!0},russian:{type:"number",required:!0},english:{type:"number",required:!0},other:{type:"number",required:!0},university:{type:"string"},speciality:{type:"string"},essay:{type:"string"},additional:{type:"string"}}},passwordSchema:{type:"object",properties:{id:{type:"number",required:!0},password:{type:"string",required:!0}}},photoSchema:{type:"object",properties:{id:{type:"number",required:!0}}}}},8166:(e,t,r)=>{const n=r(6427);e.exports={dataFill:async function(e){try{const{rowCount:t,rows:r}=await n.query("select * from public.fn_challenger_date($1);",[e]);return!!t&&r[0]}catch(e){return console.log("error challengerProfile dataFill",e.message),!1}},detail:async function(e,t){try{const{rowCount:r,rows:o}=await n.query("select * from public.fn_challenger($1, $2);",[e,t]);return!!r&&o[0]}catch(e){return console.log("error challengerPersonal detail",e.message),!1}},detailSave:async function(e,t,r){try{return!(await n.query("call sp_challenger_upd($1,$2,$3);",[e,t,r])).error}catch(e){return console.log("error challengerPersonal detailSave",e.message),!1}},photo:async function(e,t){try{return!(await n.query('call "sp_challenger_foto"($1, $2)',[e,t])).error}catch(e){return console.log("error challenger photo",e.message),!1}},updatePassword:async function(e,t){try{const{rows:r}=await n.query('UPDATE public.challenger SET "password"=$2 WHERE id_challenger=$1;',[e,t]);return r}catch(e){return console.log("error challenger updatePassword",e.message),!1}},checkPassword:async function(e,t){try{const{rows:r}=await n.query('SELECT EXISTS(select 1 from  public.challenger WHERE id_challenger=$1 and "password"=$2);',[e,t]);if(r.length>0){const{exists:e}=r[0];return e}return!1}catch(e){return console.log("error challenger checkPassword",e.message),!1}}}},3574:(e,t,r)=>{const n=r(3459);e.exports=n},5762:(e,t,r)=>{const n=r(5096),o=r(3611),s=r(7544),a=r(1415),i=r(2958),c=r(7177);e.exports=new class{async university(e,t){const r=e.cookies[s.COOKIE_NAME],{id:o}=await c.getUser(r),a=await i.university(o);return a?n(t,a,e.t("success"),!1,200):n(t,!1,e.t("error"),!0,400)}async universitySave(e,t){if(!o(e.body,a.universitySaveSchema))return n(t,{status:"error",message:e.t("inValidFormat")},e.t("inValidFormat"),!0,400);const{university:r,speciality:l,essay:u,additional:d}=e.body,g=e.cookies[s.COOKIE_NAME],{id:p}=await c.getUser(g),m=await i.universitySave(p,r,l,u,d);return m?n(t,m,e.t("success"),!1,200):n(t,!1,e.t("error"),!0,400)}}},9310:(e,t,r)=>{const n=r(6860).Router(),o=r(5762),s=r(6351);n.get("/",s.is_challenger,o.university),n.put("/",s.is_challenger,o.universitySave),e.exports=n},1415:e=>{e.exports={universitySaveSchema:{type:"object",properties:{university:{type:"string"},speciality:{type:"string"},essay:{type:"string"},additional:{type:"string"}}}}},2958:(e,t,r)=>{const n=r(6427);e.exports={university:async function(e){try{const{rows:t}=await n.query("SELECT * FROM fn_challenger_text($1);",[e]);return t}catch(e){return console.log("error challenger university",e.message),!1}},universitySave:async function(e,t,r,o,s){try{return!(await n.query("call sp_challenger_text_insUpd($1,$2,$3,$4,$5);",[e,t,r,o,s])).error}catch(e){return console.log("error challenger universitySave",e.message),!1}}}},8801:(e,t,r)=>{const n=r(9310);e.exports=n},6440:(e,t,r)=>{const n=r(5096),o=r(3611),s=r(7544),a=r(2830),i=r(5681),c=r(899),l=r(8117),u=r(7177),d=r(2919),g=s.AVATAR_PATH,p=s.APP_URL,m=s.DOC_PATH;e.exports=new class{async university(e,t){if(!o(e.params,c.chalSchema))return n(t,{status:"error",message:e.t("inValidFormat")},e.t("inValidFormat"),!0,400);const r=parseInt(e.params.id),s=await l.university(r);return s?n(t,s,e.t("success"),!1,200):n(t,!1,e.t("error"),!0,400)}async dataFill(e,t){const r=e.cookies[s.COOKIE_NAME],{id:o}=await u.getUser(r),a=await l.dataFill(o);return a?n(t,a,e.t("success"),!1,200):n(t,!1,e.t("error"),!0,400)}async detail(e,t){if(!o(e.params,c.chalSchema))return n(t,{status:"error",message:e.t("inValidFormat")},e.t("inValidFormat"),!0,400);const r=parseInt(e.params.id),s=e.i18n.resolvedLanguage,a=await d.getLangId(s),i=await l.detail(a,r);return i?n(t,i,e.t("success"),!1,200):n(t,!1,e.t("error"),!0,400)}async photoShow(e,t){const{fileName:r,size:n}=e.params,o=`${g}${"lg"===n?"lg":"sm"}-${r}`;return await i.exists(o)?t.sendFile(o):t.redirect(`/${p}/public/logo.svg`)}async info(e,t){if(!o(e.params,c.chalSchema))return n(t,{status:"error",message:e.t("inValidFormat")},e.t("inValidFormat"),!0,400);const r=parseInt(e.params.id),s=e.i18n.resolvedLanguage,a=await d.getLangId(s),i=await l.info(a,r);return i?n(t,i,e.t("success"),!1,200):n(t,!1,e.t("error"),!0,400)}async doc(e,t){if(!o(e.params,c.chalSchema))return n(t,{status:"error",message:e.t("inValidFormat")},e.t("inValidFormat"),!0,400);const r=parseInt(e.params.id),s=e.i18n.resolvedLanguage,a=await d.getLangId(s),i=await l.doc(a,r);return i?n(t,i,e.t("success"),!1,200):n(t,!1,e.t("error"),!0,400)}async docShow(e,t){const{fileName:r}=e.params,n=a.onlyLetterNumberDotUnderscore(r),o=`${m}${n}`;return await i.exists(o)?t.download(o,String(n).split("_")[2]):t.redirect("/assets/logo.svg")}async export(e,t){if(!o(e.params,c.chalSchema))return n(t,{status:"error",message:e.t("inValidFormat")},e.t("inValidFormat"),!0,400);const r=parseInt(e.params.id),s=e.i18n.resolvedLanguage,a=await d.getLangId(s),i=await l.doc(a,r),u=await l.info(a,r),g=await l.detail(a,r),p=await l.university(r),m=await l.exportPdfFileExpire(),y=await l.exportPdf(g,u,p,i,m);return y?t.contentType("application/pdf").send(y):n(t,!1,e.t("error"),!0,400)}}},6482:(e,t,r)=>{const n=r(6860).Router(),o=r(6440),s=r(6351);n.get("/university/:id",s.isStaffToken,o.university),n.post("/fill",s.isStaffToken,o.dataFill),n.get("/detail/:id",s.isStaffToken,o.detail),n.get("/photo/:size/:fileName",o.photoShow),n.get("/info/:id",s.isStaffToken,o.info),n.get("/file/:fileName",s.isStaffToken,o.docShow),n.get("/doc/:id",s.isStaffToken,o.doc),n.get("/export/:id",s.isStaffToken,o.export),e.exports=n},899:e=>{e.exports={passwordSchema:{type:"object",properties:{id:{type:"number",required:!0},password:{type:"string",required:!0}}},photoSchema:{type:"object",properties:{id:{type:"number",required:!0}}},chalSchema:{type:"object",properties:{id:{type:"string",required:!0}}}}},8117:(e,t,r)=>{const n=r(8983),o=r(1635),s=r(6427),a=r(5681),i=r(5325),c=r(7544),l=c.DOC_PATH,u=c.ALLOW_HOST;e.exports={doc:async function(e,t){try{const{rows:r}=await s.query("select * from public.fn_challenger_document($1, $2);",[e,t]);return r}catch(e){return console.log("error challenger doc",e.message),!1}},iudDocFile:async function(e,t,r,n,o){try{const s=`${l}${e}_${t}_${n}`;return 0===r&&await a.write(s,o),1===r&&await a.write(s,o),2===r&&await a.deleteFile(s),!0}catch(e){return console.log("error iudDocFile",e.message),!1}},dataFill:async function(e){try{const{rowCount:t,rows:r}=await s.query("select * from public.fn_challenger_date($1);",[e]);return!!t&&r[0]}catch(e){return console.log("error challengerProfile dataFill",e.message),!1}},detail:async function(e,t){try{const{rowCount:r,rows:n}=await s.query("select * from public.fn_challenger($1, $2);",[e,t]);return!!r&&n[0]}catch(e){return console.log("error challengerPersonal detail",e.message),!1}},photo:async function(e,t){try{return!(await s.query('call "sp_challenger_foto"($1, $2)',[e,t])).error}catch(e){return console.log("error challenger photo",e.message),!1}},updatePassword:async function(e,t){try{const{rows:r}=await s.query('UPDATE public.challenger SET "password"=$2 WHERE id_challenger=$1;',[e,t]);return r}catch(e){return console.log("error challenger updatePassword",e.message),!1}},checkPassword:async function(e,t){try{const{rows:r}=await s.query('SELECT EXISTS(select 1 from  public.challenger WHERE id_challenger=$1 and "password"=$2);',[e,t]);if(r.length>0){const{exists:e}=r[0];return e}return!1}catch(e){return console.log("error challenger checkPassword",e.message),!1}},info:async function(e,t){try{const{rowCount:r,rows:n}=await s.query("select * from public.fn_challenger_info($1, $2);",[e,t]);return!!r&&n[0]}catch(e){return console.log("error challenger info",e.message),!1}},university:async function(e){try{const{rows:t}=await s.query("SELECT * FROM fn_challenger_text($1);",[e]);return t}catch(e){return console.log("error challenger university",e.message),!1}},exportPdf:async function(e,t,r,s,a){const i=[];e&&i.push([{text:"Ф.И.О.",alignment:"left",bold:!0},{text:`${e?.surname} ${e?.name} ${e?.patronymic}`,alignment:"left"}],[{text:"Статус",alignment:"left",bold:!0},{text:e?.status,alignment:"left"}],[{text:"ПИН",alignment:"left",bold:!0},{text:e?.pin,alignment:"left"}],[{text:"Дата рождения",alignment:"left",bold:!0},{text:o(e?.birth_day).format("DD.MM.YYYY"),alignment:"left"}],[{text:"Пол",alignment:"left",bold:!0},{text:e?.gender,alignment:"left"}],[{text:"Номер паспорта",alignment:"left",bold:!0},{text:e?.passport,alignment:"left"}],[{text:"Дата выдачи",alignment:"left",bold:!0},{text:o(e?.passport_day).format("DD.MM.YYYY"),alignment:"left"}],[{text:"Телефон",alignment:"left",bold:!0},{text:e?.telephone,alignment:"left"}],[{text:"email",alignment:"left",bold:!0},{text:e?.email,alignment:"left"}]),t&&i.push([{text:"Адрес",alignment:"left",bold:!0},{text:`${t?.region}, ${t?.district_city}, ${t?.address}`,alignment:"left"}],[{text:"Претендуемый уровень образования",alignment:"left",bold:!0},{text:t?.education_level,alignment:"left"}],[{text:"Обучаемое направление",alignment:"left",bold:!0},{text:t?.lan_direction,alignment:"left"}],[{text:"Кыргызский язык/уровень владения",alignment:"left",bold:!0},{text:t?.kyrgyz,alignment:"left"}],[{text:"Русский язык/уровень владения",alignment:"left",bold:!0},{text:t?.russian,alignment:"left"}],[{text:"Английский язык/уровень владения",alignment:"left",bold:!0},{text:t?.english,alignment:"left"}],[{text:"Другой язык/уровень владения",alignment:"left",bold:!0},{text:t?.other,alignment:"left"}]),r&&i.push([{text:"Полное название высшего учебного заведения",alignment:"left",bold:!0},{text:r.university,alignment:"left"}],[{text:"Образовательная программа (специальность)",alignment:"left",bold:!0},{text:r?.speciality,alignment:"left"}],[{text:"Мотивационное эссе на кыргызском или русском или английском языках (250-500 слов)",alignment:"left",bold:!0},{text:r?.essay,alignment:"left"}],[{text:"Дополнительная информация",alignment:"left",bold:!0},{text:r?.additional,alignment:"left"}]),s&&s.forEach((e=>{i.push([{text:e.document,alignment:"left",bold:!0},{text:e.document_url?String(e.document_url).split("_")[2]:"",alignment:"left",link:e.document_url?`${u}/elumutu/api/doc/pdf/${e.document_url}?q=frompdf&u=${a}`:""}])}));var c=new n({Roboto:{normal:"./public/fonts/Roboto/Roboto-Regular.ttf",bold:"./public/fonts/Roboto/Roboto-Medium.ttf",italics:"./public/fonts/Roboto/Roboto-Italic.ttf",bolditalics:"./public/fonts/Roboto/Roboto-MediumItalic.ttf"}}),l={content:[{text:"Претендент",style:"header",alignment:"center",bold:!0},{style:"table",table:{widths:["40%","60%"],body:i?.map((e=>e))}}],footer:function(e,t){return{layout:"noBorders",fontSize:8,margin:[25,0,25,0],table:{widths:["50%","50%"],body:[[{text:o().format("DD.MM.YYYY"),alignment:"left"},{text:e.toString()+"/"+t,alignment:"right"}]]}}},pageOrientation:"portrait",pageMargins:[27,27,27,27],styles:{header:{fontSize:12,bold:!0,margin:[0,0,0,10],alignment:"center"},table:{fontSize:11,alignment:"center",margin:[0,10,0,10]}},defaultStyle:{font:"Roboto",columnGap:20}},d=c.createPdfKitDocument(l);return new Promise(((e,t)=>{try{var r=[];d.on("data",(e=>r.push(e))),d.on("end",(()=>e(Buffer.concat(r)))),d.end()}catch(e){t(e)}}))},exportPdfFileExpire:async function(){const e=new Date,t=new Date((new Date).setDate(e.getDate()+90)),r=i.encrypt(t.toJSON());return encodeURIComponent(r)}}},8280:(e,t,r)=>{const n=r(6482);e.exports=n},1691:(e,t,r)=>{const n=r(5096),o=r(3611),s=r(7544),a=r(5436),i=r(2518),c=r(2919),l=r(6351),u=r(7177);e.exports=new class{async status(e,t){const r=await l.getTokenData(e);if(!r)return n(t,!1,e.t("error"),!0,400);const o=e.i18n.resolvedLanguage,s=await c.getLangId(o),a=await i.status(s,r.type);return a?n(t,a,e.t("success"),!1,200):n(t,!1,e.t("error"),!0,400)}async mon(e,t){const r=e.i18n.resolvedLanguage,o=await c.getLangId(r),s=await i.mon(o);return s?n(t,s,e.t("success"),!1,200):n(t,!1,e.t("error"),!0,400)}async export(e,t){const{s:r}=e.query,o=e.i18n.resolvedLanguage,s=await c.getLangId(o);let a=[1,2,3,4,5];if(r){const e=JSON.parse(r);Array.isArray(e)&&(a=e.filter((e=>e>0&&e<6)).map((e=>parseInt(e))))}const l=(await i.monFilter(s,a)).map(((e,t)=>[t+1,{text:`${e.surname} ${e.name} ${e.patronymic}`,alignment:"left"},e.age,e.education_level,e.direction,e.status,e.info?"Есть":"",e.doc?"Есть":"",e.univ?`${e.university} ${e.speciality}`:""])),u=await i.exportListPdf(l);return u?t.contentType("application/pdf").send(u):n(t,!1,e.t("error"),!0,400)}async updateStatus(e,t){if(!o(e.body,a.updateStatusSchema))return n(t,{status:"error",message:e.t("inValidFormat")},e.t("inValidFormat"),!0,400);const r=e.cookies[s.COOKIE_NAME],{id:c}=await u.getUser(r);if(6==c)return n(t,!1,e.t("error"),!0,400);const{id:l,status:d}=e.body,g=await i.updateStatus(l,d);return g?(i.insertStatusHistory(l,d,c),n(t,g,e.t("success"),!1,200)):n(t,!1,e.t("error"),!0,400)}}},7976:(e,t,r)=>{const n=r(6860).Router(),o=r(1691),s=r(6351);n.get("/status",s.isStaffToken,o.status),n.put("/status",s.isMonOrAparatToken,o.updateStatus),n.get("/export",s.isStaffToken,o.export),n.get("/",s.isStaffToken,o.mon),e.exports=n},5436:e=>{e.exports={updateStatusSchema:{type:"object",properties:{id:{type:"number",required:!0},status:{type:"number",required:!0}}}}},2518:(e,t,r)=>{const n=r(8983),o=r(1635),s=r(6427);e.exports={status:async function(e,t){try{const r=2===t?'SELECT * FROM "fn_status"($1) WHERE "id_status" in(2, 3)':'SELECT * FROM "fn_status"($1) WHERE "id_status" in(4, 5)',{rows:n}=await s.query(r,[e]);return n}catch(e){return console.log("error mon status",e.message),!1}},mon:async function(e){try{const{rowCount:t,rows:r}=await s.query('SELECT * FROM "fn_challenger_mon"($1)',[e]);return r}catch(e){return console.log("error mon list",e.message),!1}},exportListPdf:async function(e){const t=[[{text:"№",style:"header"},{text:"Ф.И.О.",style:"header",alignment:"left"},{text:"Возраст",style:"header"},{text:"Уровень",style:"header"},{text:"Направление",style:"header"},{text:"Статус",style:"header"},{text:"Данные",style:"header"},{text:"Документы",style:"header"},{text:"Университет",style:"header"}]];t.push(...e);var r=new n({Roboto:{normal:"./public/fonts/Roboto/Roboto-Regular.ttf",bold:"./public/fonts/Roboto/Roboto-Medium.ttf",italics:"./public/fonts/Roboto/Roboto-Italic.ttf",bolditalics:"./public/fonts/Roboto/Roboto-MediumItalic.ttf"}}),s={content:[{text:"Список претендентов",style:"header",alignment:"center",bold:!0},{style:"table",table:{widths:["5%","25%","5%","12%","15%","10%","5%","5%","18%"],body:t?.map((e=>e))}}],footer:function(e,t){return{layout:"noBorders",fontSize:8,margin:[25,0,25,0],table:{widths:["50%","50%"],body:[[{text:o().format("DD.MM.YYYY"),alignment:"left"},{text:e.toString()+"/"+t,alignment:"right"}]]}}},pageOrientation:"landscape",pageMargins:[27,27,27,27],styles:{header:{fontSize:12,bold:!0,margin:[0,0,0,10],alignment:"center"},table:{fontSize:11,alignment:"center",margin:[0,10,0,10]}},defaultStyle:{font:"Roboto",columnGap:20}},a=r.createPdfKitDocument(s);return new Promise(((e,t)=>{try{var r=[];a.on("data",(e=>r.push(e))),a.on("end",(()=>e(Buffer.concat(r)))),a.end()}catch(e){t(e)}}))},updateStatus:async function(e,t){try{return!(await s.query("call sp_challenger_status($1,$2);",[e,t])).error}catch(e){return console.log("error mon updateStatus",e.message),!1}},insertStatusHistory:async function(e,t,r){try{const{rowCount:n}=await s.query("INSERT INTO public.status_history (id_user, id_status, id_chal) VALUES( $1, $2, $3);",[r,t,e]);return!!n&&rows[0]}catch(e){return console.log("error mon insertStatusHistory",e.message),!1}},monFilter:async function(e,t){try{const{rowCount:r,rows:n}=await s.query(`SELECT * FROM "fn_challenger_mon"($1) where id_status in (${t.join(",")})`,[e]);return n}catch(e){return console.log("error mon list",e.message),!1}}}},7703:(e,t,r)=>{const n=r(7976);e.exports=n},94:(e,t,r)=>{const n=r(5078);e.exports=n},331:(e,t,r)=>{const n=r(5096),o=r(3611),s=r(7544),a=r(7782),i=r(5816),c="true"===s.CHECK_TUNDUK;e.exports=new class{async challenger(e,t){try{if(!o(e.body,a.challengerSchema))return n(t,!1,e.t("inValidFormat"),!0,400);if("false"===s.REGISTER_ALLOW)return n(t,!1,"Закончился срок регистрации",!0,400);const{body:r}=e,{lang:l,surname:u,name:d,middlename:g,dateBirth:p,gender:m,passport:y,datePassport:f,email:h,password:w,tel:E,pin:S}=r,_=i.getAge(p);if(_<20||_>45)return n(t,!1,e.t("register.ageError"),!0,400);const x=Number(S);if(await i.isPinExist(x))return n(t,!1,e.t("register.pinExist"),!0,400);if(await i.isEmailExist(h))return n(t,!1,e.t("register.emailExist"),!0,400);let b=d,O=u,I=g||"",C=p,T=m,v=`0${String(E).slice(3,12)}`;if(x&&c){const r=await i.dataByPin(x),{data:o,error:s}=await i.fetchData(r);if(s)return n(t,!1,e.t("register.pinOrPassportInCorrect"),!0,400);if(o.name.toLowerCase()!=d.toLowerCase().trim())return n(t,!1,e.t("register.nameInCorrect"),!0,400);if(o.surname.toLowerCase()!=u.toLowerCase().trim())return n(t,!1,e.t("register.surnameInCorrect"),!0,400);if(o.dateOfBirth!=p)return n(t,!1,e.t("register.dateBirthInCorrect"),!0,400);b=o.name,O=o.surname,I=o.patronymic,C=o.dateOfBirth,T=o.gender,console.log("XML",o.pin)}const $=i.md5(w),A=i.insertChallenger(O,b,I,x,parseInt(T),C,y,f,v,h,$);return A?n(t,!0,e.t("register.success"),!0,200):n(t,!1,0==A?e.t("register.dbInsertChallengerError"):e.t("register.unknownError"),!0,400)}catch(r){return console.log("Error register user",r),n(t,!1,e.t("register.tryError"),!0,400)}}}},5078:(e,t,r)=>{const n=r(6860).Router(),o=r(331);n.post("/challenger",o.challenger),e.exports=n},7782:e=>{e.exports={challengerSchema:{type:"object",properties:{lang:{type:"string",minLength:2,maxLength:2,required:!0},surname:{type:"string",minLength:1,required:!0},name:{type:"string",minLength:1,required:!0},dateBirth:{type:"string",minLength:10,maxLength:10,required:!0},gender:{type:"number",required:!0},passport:{type:"string",required:!0},datePassport:{type:"string",minLength:10,maxLength:10,required:!0},email:{type:"string"},password:{type:"string",minLength:6,required:!0},tel:{type:"string",minLength:10,maxLength:20,required:!0},pin:{type:"string",minLength:14,maxLength:14,required:!0}}}}},5816:(e,t,r)=>{const n=r(2167),o=r(855),s=r(6427),{md5:a}=r(2830);e.exports={dataByPin:async function(e){return`<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"  \n  xmlns:xro="http://x-road.eu/xsd/xroad.xsd"  \n  xmlns:iden="http://x-road.eu/xsd/identifiers"  \n  xmlns:zags="http://tunduk-seccurity-infocom.x-road.fi/producer">  \n  <soapenv:Header>  \n  <xro:userId>1</xro:userId>  \n  <xro:service iden:objectType="SERVICE">  \n  <iden:xRoadInstance>central-server</iden:xRoadInstance>  \n  <iden:memberClass>GOV</iden:memberClass>  \n  <iden:memberCode>70000005</iden:memberCode>  \n  \x3c!--Optional:--\x3e  \n  <iden:subsystemCode>zags-service</iden:subsystemCode>  \n  <iden:serviceCode>zagsDataByPin</iden:serviceCode>  \n  <iden:serviceVersion>v1</iden:serviceVersion>  \n  </xro:service>  \n  <xro:protocolVersion>4.0</xro:protocolVersion>  \n  <xro:issue>123</xro:issue>  \n  <xro:id>1</xro:id>  \n  <xro:client iden:objectType="SUBSYSTEM">  \n  <iden:xRoadInstance>central-server</iden:xRoadInstance>  \n  <iden:memberClass>GOV</iden:memberClass>  \n  <iden:memberCode>70000016</iden:memberCode>  \n  \x3c!--Optional:--\x3e  \n  <iden:subsystemCode>umut</iden:subsystemCode>  \n  </xro:client>  \n  </soapenv:Header>  \n  <soapenv:Body>  \n  <zags:zagsDataByPin>  \n  <request>  \n  <pin>${e}</pin>  \n  </request>  \n  </zags:zagsDataByPin>  \n  </soapenv:Body>  \n  </soapenv:Envelope>`},fetchData:async function(e){try{const t=await n.post("http://192.168.100.243",e,{timeout:3e4,headers:{"Content-Type":"text/xml"}}),r=(await async function(e){const t=new o.Parser;return await new Promise(((r,n)=>t.parseString(e,((e,t)=>{e?n(e):r(t)}))))}(t.data))["SOAP-ENV:Envelope"]["SOAP-ENV:Body"][0]["ts1:zagsDataByPinResponse"][0]["ts1:response"][0];return r.faultcode?{data:!1,error:"404"}:r["ts1:pin"]?{data:{pin:r["ts1:pin"][0],name:r["ts1:name"][0],surname:r["ts1:surname"][0],patronymic:r["ts1:patronymic"][0],gender:r["ts1:gender"][0],nationality:r["ts1:nationality"][0],nationalityId:r["ts1:nationalityId"][0],citizenship:r["ts1:citizenship"][0],citizenshipId:r["ts1:citizenshipId"][0],dateOfBirth:r["ts1:dateOfBirth"][0].slice(0,10)},error:!1}:{data:!1,error:"400"}}catch(e){return console.log("zags fetchData error ",e.message),{data:!1,error:e.message}}},isPinExist:async function(e){try{const{rows:t}=await s.query("SELECT EXISTS( select 1 FROM challenger where challenger.pin =$1)",[e]);if(t.length>0){const{exists:e}=t[0];return e}return!1}catch(e){return console.log("error login",e.message),!1}},isEmailExist:async function(e){try{const{rows:t}=await s.query("SELECT EXISTS( select 1 FROM challenger where challenger.email =$1)",[e]);if(t.length>0){const{exists:e}=t[0];return e}return!1}catch(e){return console.log("error login",e.message),!1}},insertChallenger:async function(e,t,r,n,o,a,i,c,l,u,d){try{return!(await s.query('call "sp_challenger_ins"($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11);',[e,t,r,n,o,a,i,c,l,u,d])).error}catch(e){return console.log("error insertChallenger",e.message),!1}},getAge:function(e){var t=new Date,r=new Date(e),n=t.getFullYear()-r.getFullYear(),o=t.getMonth()-r.getMonth();return(o<0||0===o&&t.getDate()<r.getDate())&&n--,n},md5:a}},6351:(e,t,r)=>{const n=r(8308),o=r(5096),s=r(7544),a=r(2751),i=(e,t)=>o(e,!1,t,!0,401);async function c(e,t,r,a){if("development"===s.NODE_ENV&&"true"===s.FAKE_AUTH_MODE)r();else{if(!await n.CHECK_PERM(e,a))return o(t,!1,e.t("token.noAuth"),!0,401);r()}}const l=async(e,t,r,n)=>{try{"development"===s.NODE_ENV&&"true"===s.FAKE_AUTH_MODE&&r();const o=e.cookies[s.COOKIE_NAME];if(e.token=o,o){const c=a.getTokenData(o);return"development"===s.NODE_ENV&&(console.log({decodedData:c}),console.log(new Date(c.exp)),console.log(new Date),console.log(c.exp>new Date)),o&&c&&c.exp>new Date?n.includes(c.type)?(e.user=c,r()):i(t,"Permission denied"):i(t,"token invalid")}return i(t,"token not found")}catch(e){return console.log("CheckUser error catch =>",e),i(t,"token expired")}};e.exports={is_staff:async function(e,t,r){return await c(e,t,r,!0)},is_challenger:async function(e,t,r){return await c(e,t,r,!1)},is_staff_or_challenger:async function(e,t,r){return await c(e,t,r,0)},isChallengerToken:async(e,t,r)=>await l(e,t,r,[1]),isMonToken:async(e,t,r)=>await l(e,t,r,[2]),isAparatToken:async(e,t,r)=>await l(e,t,r,[3]),isStaffToken:async(e,t,r)=>await l(e,t,r,[2,3,4]),getTokenData:async e=>{try{const t=e.cookies[s.COOKIE_NAME];if(t){const e=a.getTokenData(t);if(t&&e&&e.exp>new Date)return e}return!1}catch(e){return console.log("getTokenData error catch =>",e),!1}},isExpertToken:async(e,t,r)=>await l(e,t,r,[4]),isMonOrAparatToken:async(e,t,r)=>await l(e,t,r,[2,3])}},2919:e=>{e.exports={getLangId:async function(e){try{let t=1;switch(e){case"ru":default:t=1;break;case"kg":t=3;break;case"en":t=2}return t}catch(e){return console.log("error getLangId",e.message),1}},langIdNext:async function(e,t,r){try{const t=e.i18n.resolvedLanguage;let n=1;switch(t){case"ru":default:n=1;break;case"kg":n=2;break;case"en":n=3}e.langId=n,r()}catch(t){e.langId=1,r()}}}},7729:(e,t,r)=>{const n=r(6427);e.exports={logDB:async function(e,t,r,o,s,a){const i=await n.query("INSERT INTO public.logs\n                  (text_log, type_log, action_name,  id_user, json_log, execution_time, is_staff)\n                VALUES($1, $2, $3, $4, $5::jsonb, current_timestamp, $6);",[e,t,r,s,JSON.stringify(o),a]);return console.log("public.logs",i),1}}},7177:(e,t,r)=>{const n=r(6427),{md5:o}=r(2830),s=r(7544);e.exports={getUser:async function(e){try{if("development"===s.NODE_ENV&&"true"===s.FAKE_AUTH_MODE){return{id:parseInt(s.FAKE_ID)||12,staff:"true"===s.FAKE_IS_STAFF}}const{rowCount:t,rows:r}=await n.query('SELECT * FROM "fn_Session_Get_User"($1)',[o(String(e))]);return!!t&&{...r[0]}}catch(e){return console.log("error getUser",e.message),!1}}}},6184:(e,t,r)=>{const n=r(6426);e.exports=n},76:(e,t,r)=>{const n=r(5096),o=r(3611),s=r(8083),a=r(6282),i=r(2919);e.exports=new class{async dateEnd(e,t){const r=await a.dateEnd();return r?n(t,r,e.t("success"),!1,200):n(t,!1,e.t("error"),!0,400)}async region(e,t){const r=e.i18n.resolvedLanguage,o=await i.getLangId(r),s=await a.region(o);return s?n(t,s,e.t("success"),!1,200):n(t,!1,e.t("error"),!0,400)}async district(e,t){if(!o(e.query,s.districtSchema))return n(t,{status:"error",message:e.t("inValidFormat")},e.t("inValidFormat"),!0,400);const r=e.i18n.resolvedLanguage,c=await i.getLangId(r),{region:l}=e.query,u=await a.district(c,parseInt(l));return u?n(t,u,e.t("success"),!1,200):n(t,!1,e.t("error"),!0,400)}async education(e,t){const r=e.i18n.resolvedLanguage,o=await i.getLangId(r),s=await a.education(o);return s?n(t,s,e.t("success"),!1,200):n(t,!1,e.t("error"),!0,400)}async direction(e,t){if(!o(e.query,s.directionSchema))return n(t,{status:"error",message:e.t("inValidFormat")},e.t("inValidFormat"),!0,400);const r=e.i18n.resolvedLanguage,c=await i.getLangId(r),{education:l}=e.query,u=await a.direction(c,parseInt(l));return u?n(t,u,e.t("success"),!1,200):n(t,!1,e.t("error"),!0,400)}async status(e,t){const r=e.i18n.resolvedLanguage,o=await i.getLangId(r),s=await a.status(o);return s?n(t,s,e.t("success"),!1,200):n(t,!1,e.t("error"),!0,400)}}},6426:(e,t,r)=>{const n=r(6860).Router(),o=r(76);n.get("/date",o.dateEnd),n.get("/region",o.region),n.get("/district",o.district),n.get("/education",o.education),n.get("/direction",o.direction),n.get("/status",o.status),e.exports=n},8083:e=>{e.exports={districtSchema:{type:"object",properties:{region:{type:"string",required:!0}}},directionSchema:{type:"object",properties:{education:{type:"string",required:!0}}}}},6282:(e,t,r)=>{const n=r(6427);e.exports={dateEnd:async function(){try{const{rowCount:e,rows:t}=await n.query("SELECT * FROM fn_tour()",[]);return!!e&&t[0]}catch(e){return console.log("error dateEnd",e.message),!1}},status:async function(e){try{const{rows:t}=await n.query('SELECT * FROM "fn_status"($1)',[e]);return t}catch(e){return console.log("error direction",e.message),!1}},region:async function(e){try{const{rows:t}=await n.query('SELECT * FROM "fn_region"($1)',[e]);return t}catch(e){return console.log("error region",e.message),!1}},district:async function(e,t){try{const{rows:r}=await n.query('SELECT * FROM "fn_district_city"($1, $2)',[e,t]);return r}catch(e){return console.log("error region",e.message),!1}},education:async function(e){try{const{rows:t}=await n.query('SELECT * FROM "fn_education_level"($1)',[e]);return t}catch(e){return console.log("error education",e.message),!1}},direction:async function(e,t){try{const{rows:r}=await n.query('SELECT * FROM "fn_education_level_direction"($1, $2)',[e,t]);return r}catch(e){return console.log("error direction",e.message),!1}}}},6340:(e,t,r)=>{const n=r(6537);e.exports=n},1480:(e,t,r)=>{const n=r(5096),o=r(3611),s=r(8308),a=r(2830),{logDB:i}=r(7729),c=r(2751),l=r(5817),u=r(7092),d=r(7544);e.exports=new class{async login(e,t){const r=o(e.body,l.userSchema),{login:g,password:p}=e.body,m=!a.isNumeric(g),y=String(g).length,f=m?y>=4:14===y;if(!r||!f)return i("inValidFormat","EXCEPTION","login",JSON.stringify({...e.body,isValid:r,matchStatus:f,is_staff:m}),0,m),n(t,!1,e.t("inValidFormat"),!0,400);const h=await u.login(String(g),p,m);if(h){const r=await u.userName(h,m),o=await u.userRole(h,m),a=Date.now()+60*parseInt(d.JWT_EXPIRE_HOURS)*60*1e3,i=c.generateAccessToken({id:h,type:o,s:r.surname,n:r.name,p:r.patronymic,exp:a});if(!i)return n(t,!1,"tokenGenerateError",!0,400);const l="Bearer "+i,p=await s.LOGIN(e,t,m,g,h,l);if(t.cookie(d.COOKIE_NAME,l,{expiresIn:a,httpOnly:!0,Path:d.COOKIE_PATH,SameSite:"None"}),p&&r)return n(t,{authState:{type:o,s:r.surname,n:r.name,p:r.patronymic,exp:a},token:"token",tokenType:"cookie",expiresIn:60*parseInt(d.JWT_EXPIRE_HOURS)},"success",!1,200)}return n(t,!1,e.t("unauth"),!0,401)}async check(e,t){const r=e.cookies[d.COOKIE_NAME];if(!r)return t.cookie(d.COOKIE_NAME,"tokenWillBeDeleted",{maxAge:0,httpOnly:!0,Path:d.COOKIE_PATH,SameSite:"None"}),n(t,!1,"noCookie",!0,401);const o=c.getTokenData(r),a=1!==o.type,i=await s.CHECK_PERM(e,a);return o&&o.exp>new Date&&i?n(t,{authState:{type:o.type,s:o.s,n:o.n,p:o.p,exp:o.exp},token:"token",tokenType:"cookie",expiresIn:parseInt((o.exp-Date.now())/6e4)},"success",!1,200):(t.cookie(d.COOKIE_NAME,"tokenWillBeDeleted",{maxAge:0,httpOnly:!0,Path:d.COOKIE_PATH,SameSite:"None"}),n(t,!1,"error",!0,401))}async logout(e,t){return await s.LOGOUT(e,t),t.cookie(d.COOKIE_NAME,"tokenWillBeDeleted",{maxAge:0,httpOnly:!0,Path:d.COOKIE_PATH,SameSite:"None"}),n(t,!0,e.t("success"),!1,200)}}},6537:(e,t,r)=>{const n=r(6860).Router(),o=r(1480);n.post("/login/:is_staff",o.login),n.post("/check",o.check),n.post("/logout",o.logout),e.exports=n},5817:e=>{e.exports={userSchema:{type:"object",properties:{login:{type:["string","number"],required:!0},password:{type:"string",required:!0}}},userAdminSchema:{type:"object",properties:{login:{type:"string",required:!0},password:{type:"string",required:!0}}},userChallengerSchema:{type:"object",properties:{login:{type:"number",required:!0},password:{type:"string",required:!0}}}}},7092:(e,t,r)=>{const n=r(6427),{md5:o}=r(2830),s=r(7544);e.exports={getUser:async function(e){try{if("development"===s.NODE_ENV&&"true"===s.FAKE_AUTH_MODE){return{id:parseInt(s.FAKE_ID)||12,staff:"true"===s.FAKE_IS_STAFF}}const{rowCount:t,rows:r}=await n.query('SELECT * FROM "fn_Session_Get_User"($1)',[o(String(e))]);return!!t&&{...r[0]}}catch(e){return console.log("error getUser",e.message),!1}},login:async function(e,t,r){try{const s=o(t),{rows:a}=await n.query("select * from fn_auth($1, $2, $3);",[e,s,r]);if(a.length>0){const{id:e}=a[0];return e}return!1}catch(e){return console.log("error login",e.message),!1}},userName:async function(e,t){try{const r="select name, surname, patronymic from challenger where id_challenger = $1 limit 1;",o="select name, surname, patronymic from public.user where id_user = $1 limit 1;",{rows:s}=await n.query(t?o:r,[e]);return s.length>0&&s[0]}catch(e){return console.log("error login",e.message),!1}},userRole:async function(e,t){try{if(!1===t)return 1;const{rows:r}=await n.query("select id_role as role from public.user where id_user = $1 limit 1;",[e]);return r.length>0&&r[0].role}catch(e){return console.log("error login",e.message),!1}}}},7544:(e,t,r)=>{r(5142).config();const n=process.env.APP_URL||"elumutu",o=process.env.AVATAR_PATH||"C:\\",s=process.env.DOC_PATH||"C:\\",a=process.env.JWT_ACCESS_SECRET||"5c543f356c79a4717708dfdde1a872c9bc6a4369d2b419bc0a8c234ea9795df71727a375bea260aede25f87fa5d504c029eb7f9513f2792eea169cc5cf2d0db2",i=process.env.JWT_EXPIRE_HOURS||"30h";console.log({JWT_ACCESS_SECRET:a});const c=process.env.COOKIE_NAME||"tokenElUmutu",l=process.env.COOKIE_PATH||"/elumutu/api",u=process.env.MAX_AGE||"6000000",d=process.env.ALLOW_HOST||"http://mon.sc.on.kg",g=["http://localhost:3000",d],p=process.env.DBUSER||"DBUSER",m=process.env.DBPASS||"DBPASS",y=process.env.DBSERVER||"localhost",f=process.env.DBPORT||"1433",h=process.env.DBNAME||"AVN",w=process.env.DBPG_MAX_CONNECTIONS||20,E=process.env.DBPG_IDLETIMEOUTMILLLIS||3e4,S=process.env.DBPG_CONNECTIONTIMEOUTMILLES||2e3,_=process.env.DEBUG_MODE||"false",x=process.env.FAKE_AUTH_MODE||"false",b=process.env.FAKE_IS_STAFF||"false",O=process.env.FAKE_ID||11,I=process.env.PORT||"3000",C=process.env.CHECK_TUNDUK||"false",T=process.env.REGISTER_ALLOW||"false";e.exports={REGISTER_ALLOW:T,JWT_ACCESS_SECRET:a,JWT_EXPIRE_HOURS:i,COOKIE_PATH:l,MAX_AGE:u,ALLOW_HOST:d,ALLOW_HOST_LIST:g,COOKIE_NAME:c,DBUSER:p,DBPASS:m,DBSERVER:y,DBNAME:h,DBPORT:f,DBPG_MAX_CONNECTIONS:w,DBPG_IDLETIMEOUTMILLLIS:E,DBPG_CONNECTIONTIMEOUTMILLES:S,PORT:I,NODE_ENV:"production",DEBUG_MODE:_,FAKE_AUTH_MODE:x,FAKE_IS_STAFF:b,FAKE_ID:O,APP_URL:n,AVATAR_PATH:o,DOC_PATH:s,CHECK_TUNDUK:C}},8308:(e,t,r)=>{const{v4:n}=r(5828),{md5:o}=r(2830),s=r(6427),a=r(7544),i=a.COOKIE_NAME,c=a.COOKIE_MOBILE;async function l(e){if("development"===a.NODE_ENV&&"true"===a.FAKE_MODE)return{role:a.FAKE_ID_ROLE,id:a.FAKE_ID_USER};if(e&&e.cookies&&i in e.cookies){const{rowCount:t,rows:r}=await s.query('SELECT * FROM "fn_Session_Get_User"($1)',[o(String(e.cookies[i]))]);if(t)return{...r[0]}}return!1}async function u(e,t,r,n,o){const{rowCount:a}=await s.query('\n        INSERT INTO "Session_log" (login, is_staff, id_user, log_time, is_mobile, ip)\n        VALUES ($1, $2, $3, current_timestamp, $4, $5)',[e,t,r,n,o]);return!!a}parseInt(a.MAX_AGE),e.exports.LOGIN=async function(e,t,r,a,i,l=!1){const d="true"==String(e.cookies[c]),g=l||await async function(e){return n()}(),p=o(g),m=e.headers["x-forwarded-for"]?e.headers["x-forwarded-for"].split(",").shift():e.ip,{rows:y}=await s.query('SELECT  EXISTS( select 1 FROM "Session" where login =$1)',[String(a)]);if(y[0].exists){const{rowCount:e}=await s.query('UPDATE "Session" \n                                             SET offline=false, \n                                                 last_action=current_timestamp, \n                                                 cookie=$2, \n                                                 is_staff=$3, \n                                                 id_user=$4, \n                                                 is_mobile=$5\n                                             WHERE login=$1',[String(a),p,r,i,d]);return e&&await u(String(a),r,i,d,m),g}{const{rowCount:e}=await s.query('\n            INSERT INTO "Session" (cookie, is_staff, login, id_user, last_action, is_mobile)\n            VALUES ($1, $2, $3, $4, current_timestamp, $5)',[p,r,a,i,d]);return e&&await u(String(a),r,i,d,m),g}},e.exports.LOGOUT=async function(e,t){const r=o(String(e.cookies[i]));t.clearCookie(i);const{command:n,rowCount:a}=await s.query('UPDATE "Session" SET offline=true\n                                                WHERE offline=false AND login IN\n                                                (SELECT login FROM "Session" \n                                                WHERE cookie=$1)',[r]);return"UPDATE"==n&&{rowCount:a}},e.exports.CHECK_PERM=async function(e,t=0){const r=await l(e);return e.user=r,!(!r||r.staff!==t&&0!==t)},e.exports.GET_USER=l,e.exports.COOKIE_NAME=i},208:(e,t,r)=>{const{ALLOW_HOST_LIST:n}=r(7544);e.exports={corsOptionsDelegate:function(e,t){t(null,-1!==n.indexOf(e.header("Origin"))?{origin:!0,credentials:!0}:{origin:!1})}}},5325:(e,t,r)=>{var n=r(6113),o=Buffer.from("3e10bb241d611ac910af5d8690011e6c","hex"),s=Buffer.from("34db16c275e2895654e798794f6e47ae","hex"),a="aes-128-cbc";e.exports={encrypt:function(e){var t=n.createCipheriv(a,s,o);return t.update(e,"utf8","base64")+t.final("base64")},decrypt:function(e){var t=n.createDecipheriv(a,s,o);return t.update(e,"base64","utf8")+t.final("utf8")}}},6427:(e,t,r)=>{const{Pool:n}=r(5900),o=r(9427),s=r(7544),a=new n({host:s.DBSERVER,port:s.DBPORT,database:s.DBNAME,user:s.DBUSER,password:s.DBPASS,max:parseInt(s.DBPG_MAX_CONNECTIONS),idleTimeoutMillis:parseInt(s.DBPG_IDLETIMEOUTMILLLIS),connectionTimeoutMillis:parseInt(s.DBPG_CONNECTIONTIMEOUTMILLES)});!async function(){try{return a.query("select 1 as answer",[]).then((e=>{console.log("Connected to PG=>",e.rows[0]&&1==e.rows[0].answer)})).catch((e=>{throw console.error("Error executing query",e.stack),o.Sentry.captureException(e),new Error(e)}))}catch(e){return{rows:[],rowCount:0,error:e.message}}}(),e.exports={query:(e,t)=>async function(e,t){try{const r=await a.query(e,t);return{rows:r.rows,rowCount:r.rowCount,error:!1}}catch(r){return console.log("PG ERROR=>",r),console.log("PG query",{text:e,params:t}),o.Sentry.captureException(r),{rows:[],rowCount:0,error:r.message}}}(e,t),callback:(e,t,r)=>a.query(e,t,r)}},5681:(e,t,r)=>{const n=r(7147);e.exports={exists:async e=>!!await n.promises.stat(e).catch((e=>("true"===process.env.DEBUG_MODE&&console.debug(e),!1))),deleteFile:async e=>await n.promises.unlink(e).catch((e=>("true"===process.env.DEBUG_MODE&&console.debug(e),!1))),listDir:async e=>await n.promises.readdir(e).catch((e=>("true"===process.env.DEBUG_MODE&&console.debug(e),[]))),write:async(e,t)=>await n.promises.writeFile(e,t,"utf8"),read:async e=>await n.promises.readFile(e,"utf8")}},9418:e=>{e.exports={frontendRoutes:["home","login","logout","settings","personal","info","doc","university","regulations","challenger","manual","not-found"]}},5304:(e,t,r)=>{const n=r(8805),o=r(5763),s=r(6379),a={ru:{translation:r(1089)},kg:{translation:r(7791)},en:{translation:r(7551)}};n.use(o).use(s.LanguageDetector).init({resources:a,defaultNS:"translation",detection:{order:["querystring","cookie"],cache:["cookie"],lookupQuerystring:"lang",lookupCookie:"lang"},fallbackLng:["ru","kg","en"],preload:["ru"]});const i=s.handle(n);e.exports=i},1726:(e,t,r)=>{const n=r(7441);e.exports={minimized:async(e,t,r="jpeg")=>{try{const o=`${t}${r}`;return console.log("MINIMIZED IMAGE destination",o),await n(e).resize(100,100,{fit:n.fit.outside,withoutEnlargement:!0}).toFormat(r).toFile(o),!0}catch(e){return console.log("MINIMIZED IMAGE ERROR"),console.log(e),!1}},normal:async(e,t,r="jpeg")=>{try{const o=`${t}${r}`;return console.log("Normal IMAGE destination",o),await n(e).resize(500,500,{fit:n.fit.outside,withoutEnlargement:!0}).toFormat(r).toFile(o),!0}catch(e){return console.log("Normal IMAGE ERROR"),console.log(e),!1}},withoutConfig:async(e,t,r="jpeg")=>{try{const o=`${t}${r}`;return console.log("withoutConfig IMAGE destination",o),await n(e).toFormat(r).toFile(o),!0}catch(e){return console.log("withoutConfig IMAGE ERROR"),console.log(e),!1}}}},2751:(e,t,r)=>{const n=r(9344),o=r(5325),{JWT_ACCESS_SECRET:s,JWT_EXPIRE_HOURS:a}=r(7544);e.exports={generateAccessToken:e=>n.sign({data:o.encrypt(JSON.stringify(e))},s,{expiresIn:a}),verifyAccessToken:e=>{try{const t=String(e).split(" ");if("Bearer"!=t[0]||t[1].length<20)return!1;return n.verify(t[1],s)||!1}catch(e){return console.log(e),!1}},getTokenData:e=>{try{const t=String(e).split(" ");if("Bearer"!=t[0]||t[1].length<20)return!1;const r=n.verify(t[1],s);return!!r&&{...JSON.parse(o.decrypt(r.data))}}catch(e){return console.log(e),!1}},generateLinkToken:(e,t=600)=>n.sign({data:e},s,{expiresIn:t||a})}},5096:e=>{e.exports=(e,t=!1,r="OK",n=!1,o=200)=>e.status(o).json({data:t,message:r,error:n})},9427:(e,t,r)=>{const n=r(9856),o=r(4842);e.exports={initSentry:function(e){n.init({dsn:"https://3a772c29b3cb48d4be55edb069b2ef19@o188902.ingest.sentry.io/4504909839400960",integrations:[new n.Integrations.Http({tracing:!0}),new o.Integrations.Express({app:e})],tracesSampleRate:.001})},Sentry:n}},9840:e=>{e.exports={union:function(e,t){let r=new Set(e);for(let e of t)r.add(e);return r},intersection:function(e,t){let r=new Set;for(let n of t)e.has(n)&&r.add(n);return r},difference:function(e,t){let r=new Set(e);for(let e of t)r.delete(e);return r},subset:function(e,t){for(let r of t)if(!e.has(r))return!1;return!0}}},2830:(e,t,r)=>{const n=r(6113),o={Ң:"N",Ө:"O",Ү:"U",Ё:"YO",Й:"I",Ц:"TS",У:"U",К:"K",Е:"E",Н:"N",Г:"G",Ш:"SH",Щ:"SCH",З:"Z",Х:"H",Ъ:"'",ё:"yo",й:"i",ц:"ts",у:"u",к:"k",е:"e",н:"n",г:"g",ш:"sh",щ:"sch",з:"z",х:"h",ъ:"'",Ф:"F",Ы:"I",В:"V",А:"A",П:"P",Р:"R",О:"O",Л:"L",Д:"D",Ж:"ZH",Э:"E",ф:"f",ы:"i",в:"v",а:"a",п:"p",р:"r",о:"o",л:"l",д:"d",ж:"zh",э:"e",Я:"Ya",Ч:"CH",С:"S",М:"M",И:"I",Т:"T",Ь:"'",Б:"B",Ю:"YU",я:"ya",ч:"ch",с:"s",м:"m",и:"i",т:"t",ь:"'",б:"b",ю:"yu",ө:"o",ң:"n",ү:"u"};function s(e){return n.createHash("md5").update(e).digest("hex")}e.exports={salt:function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},md5:e=>s(e),generatePassword:()=>function(){for(var e="",t=0;t<5;++t)e+="abcdefghijkmnpqrstuvxyzABCDEFGHJKLMNPQRSTUVXYZ23456789".charAt(Math.floor(54*Math.random()));return{crypto:s(e),password:e}}(),onlyLetterNumberDot:function(e){return String(e||"").replace(/[^a-zA-ZА-Яа-яёЁ.0-9]/gm,"")||(new Date).getTime()},onlyLetterNumberDotUnderscore:function(e){return String(e||"").replace(/[^a-zA-ZА-Яа-яёЁ._0-9]/gm,"")||(new Date).getTime()},transliterate:function(e){return e.split("").map((function(e){return o[e]||e})).join("")},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)}}},3611:(e,t,r)=>{const{Validator:n}=r(9832);e.exports=(e,t)=>(new n).validate(e,t).valid},9856:e=>{"use strict";e.exports=require("@sentry/node")},4842:e=>{"use strict";e.exports=require("@sentry/tracing")},2167:e=>{"use strict";e.exports=require("axios")},7455:e=>{"use strict";e.exports=require("compression")},9710:e=>{"use strict";e.exports=require("cookie-parser")},3582:e=>{"use strict";e.exports=require("cors")},1635:e=>{"use strict";e.exports=require("dayjs")},5142:e=>{"use strict";e.exports=require("dotenv")},6860:e=>{"use strict";e.exports=require("express")},6674:e=>{"use strict";e.exports=require("express-fileupload")},8805:e=>{"use strict";e.exports=require("i18next")},6379:e=>{"use strict";e.exports=require("i18next-http-middleware")},5763:e=>{"use strict";e.exports=require("i18next-node-fs-backend")},9832:e=>{"use strict";e.exports=require("jsonschema")},9344:e=>{"use strict";e.exports=require("jsonwebtoken")},8983:e=>{"use strict";e.exports=require("pdfmake")},5900:e=>{"use strict";e.exports=require("pg")},7441:e=>{"use strict";e.exports=require("sharp")},5828:e=>{"use strict";e.exports=require("uuid")},855:e=>{"use strict";e.exports=require("xml2js")},6113:e=>{"use strict";e.exports=require("crypto")},7147:e=>{"use strict";e.exports=require("fs")},7551:e=>{"use strict";e.exports=JSON.parse('{"error":"Ошибка","inValidFormat":"inValid format"}')},7791:e=>{"use strict";e.exports=JSON.parse('{"error":"Ошибка","inValidFormat":"Туура эмес маалымат","register":{"pinExist":"Пользователь с таким ПИН/ИНН уже существует!","emailExist":"Пользователь с таким e-mail уже существует!","pinOrPassportInCorrect":"ПИН указан не верно или паспортные данные неверны","nameInCorrect":"Введите ваше имя правильно!","surnameInCorrect":"Введите вашу фамилию правильно!","dateBirthInCorrect":"Введите правильный день рождения!","ageError":"Ошибка, ваш возраст должен быть от 20 до 35!","success":"Вы успешно зарегистрированы!","dbInsertChallengerError":"Ошибка, не удалось сохранить!","unknownError":"Ошибка, неизвестная!","tryError":"Ошибка, попробуйте еще раз!"}}')},1089:e=>{"use strict";e.exports=JSON.parse('{"error":"Ошибка","inValidFormat":"Неверный формат данных","register":{"pinExist":"Пользователь с таким ПИН/ИНН уже существует!","emailExist":"Пользователь с таким e-mail уже существует!","pinOrPassportInCorrect":"ПИН указан неверно или паспортные данные неверны","nameInCorrect":"Введите ваше имя правильно!","surnameInCorrect":"Введите вашу фамилию правильно!","dateBirthInCorrect":"Введите правильную дату рождения!","ageError":"Ошибка, ваш возраст должен быть от 20 до 35!","success":"Вы успешно зарегистрированы!","dbInsertChallengerError":"Ошибка, не удалось сохранить!","unknownError":"Ошибка, неизвестная!","tryError":"Ошибка, попробуйте еще раз!"}}')}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,r),s.exports}(()=>{const e=r(6860),t=r(7455),n=r(6674),o=r(9710);var s=r(3582);const{corsOptionsDelegate:a}=r(208),i=r(5304),c=r(7544),{frontendRoutes:l}=r(9418),u=e();u.use(t()),u.use(s(a)),u.use(o()),u.use(e.json()),u.use(n()),u.use(i),u.use("/",e.static("public")),"true"===c.FAKE_AUTH_MODE&&console.log("FAKE_AUTH_MODE = true"),u.use("/elumutu/api/user",r(6340)),u.use("/elumutu/api/register",r(94)),u.use("/elumutu/api/doc",r(6919)),u.use("/elumutu/api/info",r(7444)),u.use("/elumutu/api/personal",r(3574)),u.use("/elumutu/api/university",r(8801)),u.use("/elumutu/api/mon",r(7703)),u.use("/elumutu/api/chal",r(8280)),u.use("/elumutu/api/shared",r(6184)),u.use("/elumutu/:frontpage",((e,t,r)=>{const{frontpage:n}=e.params;if(l.some((e=>n===e)))return t.sendFile(`${__dirname}/public/elumutu/index.html`);r()})),u.use("/elumutu/challenger/:id",((e,t,r)=>{const{id:n}=e.params;if(parseInt(n)>0)return t.sendFile(`${__dirname}/public/elumutu/index.html`);r()})),u.use(((e,t,r,n)=>(console.log("errorHandler","=>",{url:t.url,error:e}),r.status(400).json({error:!0,data:!1,message:e.message}))));const d=c.PORT||4e3;u.listen(d,(()=>{console.log("Application listening on port ",d)}))})(),app={}})();